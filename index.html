<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body>
    <script type="text/javascript">
    "use strict";

    var obj = {
        "attrNum": 1,
        "attrNum2": 3,
        "attrBool": true,
        "attrStr": "str",
        "attrArr": [1, 2, 3],
        "attrObj": {
            "key": "val",
            "key2": "val2"
        }
    };

    var str1 = "attrNum";
    var str2 = "attrNum2";
    var str3 = "attrNum + attrNum2";
    var str4 = "attrNum2 == attrNum";
    var str5 = "attrNum == attrNum2 ? 'true': 'false'";
    var str6 = "attrNum2 != 2 ? true : false";

    var str7 = "!attrBool";

    var str8 = "attrStr != 'str'";
    var str9 = "attrStr.length";

    var str10 = "attrArr";
    var str11 = "attrArr.length";
    var str12 = "attrArr['length']";
    var str13 = "attrArr.length != attrNum2";
    var str14 = "attrArr['length'] != attrNum2";

    var str15 = "attrObj.key";
    var str16 = "attrObj['key2']";
    var str17 = "attrObj['key2'] == attrObj.key";

    var str18 = "attrNum + attrNum2";
    var str19 = "(attrNum + attrNum2) * 3";
    var str20 = "attrNum + attrNum2 > 3 ? 'true': 'false'";

    var conditionReg = /((\!)?\=+|>(\=)?|<(\=)?|\|\||\&\&)/;
    var boolReg = /\!+/;
    var calculateReg = /[\+|\-|\/*|\/|\%]/;
    var trinocularExpReg = /[\w\W]+\?[\w\W]+\:[\w\W]+/;
    var bracketsReg = /^\([\w\W]+\)$/;
    var bracketsReplace = /^\(|\)$/;
    var attrReg = /(\w\W)+(\[(\w\W)+\])+/;

    function trim(str) {
    	return str.trim ? str.trim() : str.replace(/^\s+|\s+$/, "");
    }

    function buildFunctionStr(str, context) {
    	if(arguments.length < 2) {
    		throw new Error("method exec must pass in two arguments");
    	}
    	var isCondition = false,
    		condition = null,
    		isBoolean = false,
    		isCalculate = false,
    		isTrinocular = false,
    		isAttr = false,
    		strArr = [str],
    		strExec = "";

		isCondition = conditionReg.test(str);
		isBoolean = boolReg.test(str);

		if(isCondition) {
			condition = str.match(conditionReg)[0];
			strArr = str.split(condition);
		}

		strArr = strArr.map(function(strIn) {
			strIn = trim(strIn);

			

			try {
				new Function("return this." + strIn).call(context);
				strIn = "this." + strIn;
			} catch (ex) {
				strIn = strIn;
			}

			return strIn;

		});

		if(isCondition) {
			strExec = strArr.join(condition);
		} else {
			strExec = strArr.join("");
		}

		return strExec;
    }

    function exec(str, context) {
    	if(arguments.length < 2) {
    		throw new Error("method exec must pass in two arguments");
    	}
    	return new Function("return " + buildFunctionStr(str, context)).call(context);
    }

    for (var i = 1; i <= 3; i++) {
        console.group("str" + i + "'s execute result:");
        console.log("the expression is: " + window["str" + i]);
        console.log(exec(window["str" + i], obj));
        console.groupEnd();
    }
    </script>
</body>

</html>
